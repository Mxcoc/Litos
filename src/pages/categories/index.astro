---
import Layout from '~/layouts/Layout.astro';
import { PostsList } from '~/lib/posts'; // 假设你有这个数据源

const postsByYear = PostsList.reduce((acc, post) => {
  const year = new Date(post.date).getFullYear();
  if (!acc[year]) acc[year] = [];
  acc[year].push(post);
  return acc;
}, {});
---

<Layout title="文章分类" description="按年份分类的文章列表">
  <h1>按年份分类</h1>

  <div class="categories">
    {Object.keys(postsByYear)
      .sort((a, b) => b - a)
      .map(year => (
        <div key={year} class="year-block">
          <div class="year-header">
            <button class="year-button" data-year={year} id={`year-${year}`}>
              {year} <span class="arrow" id={`arrow-${year}`}>▶</span>
            </button>
          </div>
          <ul class="posts" id={`posts-${year}`}>
            {postsByYear[year].map(post => (
              <li key={post.slug}>
                <a href={`/posts/${post.slug}`}>{post.title}</a>
              </li>
            ))}
          </ul>
        </div>
      ))}
  </div>

  <style>
    .posts { display: none; margin-left: 1.5rem; }
    .posts.expanded { display: block; }
    .arrow { display: inline-block; transition: transform 0.2s ease; }
    .arrow.expanded { transform: rotate(90deg); }
    .year-button { background: none; border: none; cursor: pointer; font-size: 1rem; }
  </style>

  <script type="text/javascript">
    function toggleYear(element) {
      const year = element.dataset.year;
      if (!year) return;

      // 所有文章列表和箭头先重置
      const allPosts = document.querySelectorAll('.posts');
      const allArrows = document.querySelectorAll('.arrow');
      allPosts.forEach(p => p.classList.remove('expanded'));
      allArrows.forEach(a => a.classList.remove('expanded'));

      // 当前年份展开
      const postsEl = document.getElementById(`posts-${year}`);
      const arrowEl = document.getElementById(`arrow-${year}`);
      if (postsEl && arrowEl) {
        postsEl.classList.add('expanded');
        arrowEl.classList.add('expanded');
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const yearButtons = document.querySelectorAll('.year-button');
      yearButtons.forEach(btn => {
        btn.addEventListener('click', () => toggleYear(btn));
      });
    });
  </script>
</Layout>