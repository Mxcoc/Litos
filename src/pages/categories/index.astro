---
import Layout from '~/layouts/Layout.astro';

// 模拟文章列表，直接写数组
const posts = [
  { title: '文章1', slug: 'post-1', date: '2025-01-01' },
  { title: '文章2', slug: 'post-2', date: '2024-06-20' },
  { title: '文章3', slug: 'post-3', date: '2025-06-15' },
];

// 按年份分类
let postsByYear = {};
for (const post of posts) {
  const year = new Date(post.date).getFullYear();
  if (!postsByYear[year]) postsByYear[year] = [];
  postsByYear[year].push(post);
}

// 按年份倒序排序
const years = Object.keys(postsByYear).sort((a, b) => Number(b) - Number(a));
---

<Layout title="文章分类" description="按年份分类的文章列表">

  <h1>按年份分类</h1>

  <div class="categories">
    <!-- Astro 模板循环 -->
    {years.map((year) => {
      const yearPosts = postsByYear[year];
      return (
        <div class="year-block">
          <div class="year-header">
            <button class="year-button" data-year={year}>
              {year} <span class="arrow">▶</span>
            </button>
          </div>
          <ul class="posts">
            {yearPosts.map((post) => (
              <li><a href={`/posts/${post.slug}`}>{post.title}</a></li>
            ))}
          </ul>
        </div>
      );
    })}
  </div>

  <style>
    .posts { display: none; margin-left: 1.5rem; }
    .posts.expanded { display: block; }
    .arrow { display: inline-block; transition: transform 0.2s ease; }
    .arrow.expanded { transform: rotate(90deg); }
    .year-button { background: none; border: none; cursor: pointer; font-size: 1rem; }
  </style>

  <script type="module" is:inline>
    document.addEventListener('DOMContentLoaded', () => {
      const buttons = document.querySelectorAll('.year-button');
      buttons.forEach((btn) => {
        btn.addEventListener('click', () => {
          // 先关闭所有
          document.querySelectorAll('.posts').forEach(p => p.classList.remove('expanded'));
          document.querySelectorAll('.arrow').forEach(a => a.classList.remove('expanded'));

          const block = btn.closest('.year-block');
          const postsEl = block.querySelector('.posts');
          const arrowEl = btn.querySelector('.arrow');
          if (postsEl && arrowEl) {
            postsEl.classList.add('expanded');
            arrowEl.classList.add('expanded');
          }
        });
      });
    });
  </script>
</Layout>