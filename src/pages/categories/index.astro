---
import Layout from '~/layouts/Layout.astro';

// 模拟文章数据，直接放在这里，无需额外模块
const PostsList = [
  { title: '测试文章1', slug: 'test-1', date: '2025-01-01' },
  { title: '测试文章2', slug: 'test-2', date: '2024-06-20' },
  { title: '测试文章3', slug: 'test-3', date: '2025-06-15' },
];

// 按年份分类文章
const postsByYear = PostsList.reduce((acc, post) => {
  const year = new Date(post.date).getFullYear();
  if (!acc[year]) acc[year] = [];
  acc[year].push(post);
  return acc;
}, {});
---

<Layout title="文章分类" description="按年份分类的文章列表">
  <h1>按年份分类</h1>

  <div class="categories">
    {Object.keys(postsByYear)
      .sort((a, b) => Number(b) - Number(a))  {/* 转成数字排序 */}
      .map(year => (
        <div class="year-block">
          <div class="year-header">
            <button class="year-button" data-year={year}>
              {year} <span class="arrow">▶</span>
            </button>
          </div>
          <ul class="posts">
            {postsByYear[year].map(post => (
              <li>
                <a href={`/posts/${post.slug}`}>{post.title}</a>
              </li>
            ))}
          </ul>
        </div>
      ))}
  </div>

  <style>
    .posts { display: none; margin-left: 1.5rem; }
    .posts.expanded { display: block; }
    .arrow { display: inline-block; transition: transform 0.2s ease; }
    .arrow.expanded { transform: rotate(90deg); }
    .year-button { background: none; border: none; cursor: pointer; font-size: 1rem; }
  </style>

  <script type="text/javascript" is:inline>
    document.addEventListener('DOMContentLoaded', () => {
      const yearButtons = document.querySelectorAll('.year-button');
      yearButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const year = btn.dataset.year;
          if (!year) return;

          // 重置所有
          document.querySelectorAll('.posts').forEach(p => p.classList.remove('expanded'));
          document.querySelectorAll('.arrow').forEach(a => a.classList.remove('expanded'));

          // 当前年份展开
          const postsEl = btn.closest('.year-block').querySelector('.posts');
          const arrowEl = btn.querySelector('.arrow');
          if (postsEl && arrowEl) {
            postsEl.classList.add('expanded');
            arrowEl.classList.add('expanded');
          }
        });
      });
    });
  </script>
</Layout>