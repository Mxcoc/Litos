---
import Layout from "../../layouts/Layout.astro";
---

<Layout title="Memos" description="My memos timeline">
  <main id="memos" class="max-w-3xl mx-auto px-4 py-6 space-y-6">
    <p class="text-gray-500">Loading memosâ€¦</p>
  </main>
</Layout>

<script>
  async function loadMemos() {
    const container = document.querySelector("#memos");

    try {
      const res = await fetch("https://memo.cattk.com/api/memo");
      const memos = await res.json();

      container.innerHTML = memos
        .map((memo) => {
          const imgs = memo.images
            ? memo.images
                .map(
                  (src) =>
                    `<img src="${src}" class="rounded-lg w-full object-cover" loading="lazy">`
                )
                .join("")
            : "";

          return `
            <article class="p-4 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm bg-white dark:bg-gray-900">
              <p class="text-gray-800 dark:text-gray-200 whitespace-pre-wrap leading-relaxed">
                ${memo.content}
              </p>
              ${
                imgs
                  ? `<div class="grid grid-cols-2 gap-3 mt-3">${imgs}</div>`
                  : ""
              }
              <time class="block text-xs text-gray-500 mt-3">
                ${new Date(memo.created_at).toLocaleString()}
              </time>
            </article>
          `;
        })
        .join("");
    } catch (err) {
      container.innerHTML =
        "<p class='text-red-500'>Failed to load memos.</p>";
    }
  }

  loadMemos();
</script>

<style>
  @media (min-width: 768px) {
    article {
      transition: transform 0.2s, box-shadow 0.2s;
    }
    article:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
  }
</style>