---
import Layout from "@/layouts/Layout.astro";

// 定义 Memo 数据格式
type Memo = {
  id: string;
  content: string;
  created_at: string;
  images?: string[];
};

// 直接请求 JSON（BroadcastChannel 输出 JSON）
const response = await fetch("https://memo.cattk.com");
const memos: Memo[] = await response.json();
---

<Layout title="Memos" description="My memos timeline">
  <main class="max-w-3xl mx-auto px-4 py-6 space-y-6">

    {memos.map((memo: Memo) => (
      <article
        class="p-4 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm bg-white dark:bg-gray-900"
      >
        <p class="text-gray-800 dark:text-gray-200 whitespace-pre-wrap leading-relaxed">
          {memo.content}
        </p>

        {memo.images && memo.images.length > 0 && (
          <div class="grid grid-cols-2 gap-3 mt-3">
            {memo.images.map((img: string) => (
              <img
                src={img}
                alt="memo image"
                loading="lazy"
                class="rounded-lg w-full object-cover"
              />
            ))}
          </div>
        )}

        <time class="block text-xs text-gray-500 mt-3">
          {new Date(memo.created_at).toLocaleString()}
        </time>
      </article>
    ))}

  </main>
</Layout>

<style>
  @media (min-width: 768px) {
    article {
      transition: transform 0.2s, box-shadow 0.2s;
    }
    article:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
  }
</style>